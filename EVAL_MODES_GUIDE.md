# Eval 命令模式指南

`eval` 命令根据不同的执行情况，会显示不同的结果预览，让你快速了解评估结果。

## 支持的评估模式

### 1. 仅执行（无评估）
```bash
python -m src eval --agent mem0_l1_summarizer --flows mem0_l1_v3 --limit 10
```
**预览内容**：
- 单flow：ID、输出预览、Token消耗
- 多flow对比：ID、各flow输出预览

### 2. 规则评估
```bash
python -m src eval --agent mem0_l1_summarizer --flows mem0_l1_v2,mem0_l1_v3 --limit 10
```
**预览内容**：
- 单flow：ID、输出预览、规则状态、违规详情
- 多flow对比：ID、各flow输出预览、各flow规则状态

**规则统计**：
- 通过率（绿色=100%，黄色=部分通过，红色=大量失败）
- 失败案例数量
- 主要违规类型统计

### 3. 模型评估（Judge）
```bash
python -m src eval --agent mem0_l1_summarizer --flows mem0_l1_v3 --judge --limit 10
```
**预览内容**：
- ID、Flow、总体评分、Must-Have通过情况、评语预览
- 评分颜色标记（绿色≥8分，黄色≥6分，红色<6分）

**Judge统计**：
- 单flow：平均分、分数范围
- 多flow对比：各flow平均分、分数范围、Must-Have通过率对比

### 4. 规则+模型评估（推荐）
```bash
python -m src eval --agent mem0_l1_summarizer --flows mem0_l1_v2,mem0_l1_v3 --judge --limit 10
```
**完整流程**：
1. 批量执行各flow
2. 应用规则评估（快速过滤）
3. 进行模型评估（详细分析）
4. 显示Judge评估预览和统计

## 预览特点

### 智能内容裁剪
- 输出内容：自动裁剪到合适长度（60-100字符）
- 评语预览：显示前60字符
- 违规信息：显示前20-50字符

### 颜色标记系统
- **绿色**：优秀（规则100%通过，评分≥8分）
- **黄色**：良好（规则部分通过，评分≥6分）
- **红色**：需改进（规则大量失败，评分<6分）

### 统计信息
- **规则统计**：通过率、失败数量、主要违规类型
- **Token统计**：平均消耗、总消耗、按flow对比
- **Judge统计**：平均分、分数范围、Must-Have通过率

## 输出文件

### 执行结果文件
- 格式：`{agent}_{flow}.results.{timestamp}.csv`
- 内容：原始执行结果 + 规则评估结果（如果启用）

### Judge评估文件
- 格式：`{agent}_{flow}.eval.{timestamp}.judge.csv`
- 内容：详细的Judge评估结果，包括各维度评分和评语

## 最佳实践

### 开发阶段
1. **小样本快速验证**：`--limit 5` 快速检查基本功能
2. **规则优先**：先用规则评估快速过滤明显问题
3. **逐步扩大**：确认无误后增加样本数量

### 对比评估
1. **多版本对比**：使用多flow模式对比不同提示词版本
2. **关注Must-Have**：重点查看Must-Have通过率
3. **分析评语**：通过评语了解具体改进方向

### 成本控制
1. **规则先行**：规则评估成本几乎为零，优先使用
2. **分批评估**：大数据集分批进行Judge评估
3. **重点案例**：优先评估历史问题案例

## 示例输出解读

### 规则评估统计
```
Rules Stats by Flow
┌────────────┬───────────┬──────────────┬────────────────┐
│ Flow       │ Pass Rate │ Failed Cases │ Top Violations │
├────────────┼───────────┼──────────────┼────────────────┤
│ mem0_l1_v2 │    95.0%  │           5  │ max_chars(3)   │
│ mem0_l1_v3 │   100.0%  │           0  │                │
└────────────┴───────────┴──────────────┴────────────────┘
```
**解读**：v3版本规则通过率更高，v2版本主要问题是输出过长

### Judge评估统计
```
Judge Stats by Flow
┌────────────┬───────────┬─────────────┬─────────────────────┐
│ Flow       │ Avg Score │ Score Range │ Must-Have Pass Rate │
├────────────┼───────────┼─────────────┼─────────────────────┤
│ mem0_l1_v2 │       7.2 │   6.0-8.5   │              95.0%  │
│ mem0_l1_v3 │       8.1 │   7.0-9.0   │             100.0%  │
└────────────┴───────────┴─────────────┴─────────────────────┘
```
**解读**：v3版本在评分和Must-Have满足度上都优于v2版本

通过这些改进，`eval` 命令现在能够根据不同的评估模式提供最相关的预览信息，帮助你快速了解评估结果并做出决策。