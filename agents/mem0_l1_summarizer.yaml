id: "mem0_l1_summarizer"
name: "对话记忆总结助手"
type: "task"
description: |
  负责处理用户与角色之间的对话历史总结：
  - 提取对话中的关键信息和重要事件
  - 保持用户画像和角色画像的更新
  - 生成简洁但信息完整的对话摘要
  - 支持后续更高级别的记忆整合

business_goal: |
  在节约 tokens 的前提下，生成高质量的对话总结：
  - 保留重要的时间、地点、人物信息
  - 捕捉用户情绪和行为特征
  - 维护角色一致性
  - 为长期记忆系统提供结构化输入

expectations:
  must_have:
    - 不遗漏关键的时间和事件信息
    - 准确替换用户和角色的指代词
    - 保持客观中性的总结语调
    - 控制输出长度在合理范围内
  nice_to_have:
    - 能识别用户的情绪变化和重要约定
    - 提取用户在对话中的"设定"或"角色扮演"内容
    - 为异常或有害内容提供适当的标记

default_testset: "mem0_l1.jsonl"
# extra_testsets:
#   - "mem0_l1_test01.csv"

flows:
  - name: "mem0_l1_v1"
    file: "mem0_l1_v1.yaml"
    notes: "详细版本，包含完整的工作流程和用户画像分析"
  - name: "mem0_l1_v2"
    file: "mem0_l1_v2.yaml"
    notes: "简化版本，专注于对话内容的直接总结"
  - name: "mem0_l1_v3"
    file: "mem0_l1_v3.yaml"
    notes: "优化版本，强调重要信息提取和情绪捕捉"

evaluation:
  judge_agent_id: "judge_default"
  judge_flow: "judge_v2"
  scale:
    min: 0
    max: 10
  preferred_judge_model: "doubao-1-5-pro-32k-250115"
  temperature: 0.0
  
  # 规则层：快速过滤明显的 bad case（可选）
  # 如果不需要规则，可以完全删除 rules 部分
  rules:
    
    - id: "reasonable_length"
      kind: "max_chars"
      target: "output"
      max_chars: 2000
      action: "mark_bad"
  
  case_fields:
    # 主要输入：对话历史
    - key: "chat_round_30"
      label: "对话历史"
      section: "primary_input"
      required: true
    
    # 重要上下文：角色画像
    - key: "character_profile"
      label: "角色画像"
      section: "context"
      required: true
      truncate: 4000  # 如果太长，可以允许裁剪
    
    # 当前日程相关
    - key: "current_schedule_time"
      label: "当前日程时间"
      section: "context"
    - key: "current_schedule_full_desc"
      label: "当前日程描述"
      section: "context"
    - key: "cloth_prompt"
      label: "当前穿着"
      section: "context"
    
    # 期望说明
    - key: "expected"
      label: "测试期望说明"
      section: "meta"
      required: false
    
    # 额外字段，如果 judge 需要还能看 raw JSON
    - key: "*"
      label: "原始样本 JSON"
      section: "raw"
      as_json: true
      required: false